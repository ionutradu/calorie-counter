<html><head>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="raphael-2.1.4.min.js"></script>
    <script src="justgage.js"></script>
    <base href="http://bootstrapstudio.io/demo/" bs-system-element="" bs-hidden=""> 
                <meta charset="utf-8">
                <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
                <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <title>Main page</title><link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
            <style bs-system-element="">.custom-header{
  background:#292c2f;
  padding:20px 40px;
  box-sizing:border-box;
  border:0;
  border-radius:0;
}

.custom-header a.navbar-brand.navbar-link{
  color:#fff;
  font:normal 28px Cookie, Arial, Helvetica, sans-serif;
  line-height:0.5;
  margin-right:40px;
  background:#292c2f;
}

#g1 {
  width:400px; height:320px;
  display: inline-block;
  margin: 1em;
}

.custom-header a.navbar-brand.navbar-link span{
  color:#bc40df;
}

.custom-header ul.nav.navbar-nav.links li a{
  font:14px Arial, Helvetica, sans-serif;
  opacity:0.9;
  text-decoration:none;
  color:#fff;
  background:#292c2f;
  border:0;
}

.custom-header ul.nav.navbar-nav li a:hover{
  opacity:1;
}

.custom-header .badge{
  position:absolute;
  top:4px;
  border-radius:2px;
  font-size:11px;
  color:#fff;
  background-color:#2A6A92;
  padding:2px 4px;
  font-weight:normal;
}

.custom-header li.dropdown, .custom-header li.dropdown.open{
  background:#3a3c3e;
}

.custom-header li.dropdown .dropdown-toggle{
  border-radius:2px;
  color:#fff;
  padding:8px 14px;
  background:#3a3c3e;
  opacity:0.9;
  border:0;
  margin:0;
}

.custom-header li.dropdown .dropdown-toggle:focus, .custom-header li.dropdown .dropdown-toggle:hover, .custom-header li.dropdown .dropdown-toggle:active{
  background:#3a3c3e;
  color:#fff;
}

.custom-header ul.nav.navbar-nav.navbar-right .dropdown li a{
  font:bold 13px Arial, Helvetica, sans-serif;
}

img.dropdown-image{
  border-radius:50%;
  width:32px;
  margin-left:10px;
}

.custom-header .dropdown ul{
  background-color:#3a3c3e;
  border:0;
  min-width:140px;
}

.custom-header .dropdown ul li{
  background-color:#3a3c3e;
  padding:7px;
  text-align:center;
}

.custom-header .dropdown ul li a{
  background:#3a3c3e;
  border-radius:2px;
  color:#fff;
  padding:0;
}

.custom-header .dropdown ul li a:active, .custom-header .dropdown ul li a:focus, .custom-header .dropdown ul li a:hover{
  background:#3a3c3e;
}

.custom-header .dropdown ul li.active a{
  color:#e9ac09 !important;
}

#devices {
    overflow: scroll;
    height: 5000px; 
    margin-bottom: 50px;
    position: left;
    width: 30%;
}

.gauge {
    width: 320px;
    height: 240px;
}

.pre-scrollable {
    max-height: 1000px;
}

</style>
<style bs-system-element="" bs-hidden=""></style>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Cookie">
</head>
<body>
   <nav class="navbar navbar-default custom-header">
      <div class="container-fluid">
         <div class="navbar-header">
            <a href="#" class="navbar-brand navbar-link">
               <inline-character class="space"> </inline-character>
            </a>
         </div>
         <div class="collapse navbar-collapse" id="navbar-collapse">
            <ul class="nav navbar-nav links">
               <li id="history" role="presentation">
                  <a>
                     <inline-character>Home</inline-character>
                  </a>
               </li>
               <li role="presentation">
                  <a href="#" class="hidden">
                     <inline-character class="space"> </inline-character>
                  </a>
               </li>
               <li role="presentation">
                  <a href="#" class="hidden custom-navbar">
                     <inline-character class="space"> </inline-character>
                  </a>
               </li>
            </ul>
         </div>
      </div>
   </nav>
   
    <br>

    <div id="page" style="width: 100%">
      <div id="left1" align="left" style="width: 20%; float:left">
        <form id="person">
          <label for="weight">Weight</label>
          <input type="text" name="weight" id="weight" value="65"><br>
          <label for="age">Age</label>
          <input type="text" name="age" id="age" value="25"><br>
          <label for="exerciseDuration">Exercise duration in minutes</label>
          <input type="text" name="exerciseDuration" id="exerciseDuration" value="5"><br>
          <label for="male">Male</label>
          <input type="radio" name="gender" id="male" value="male" checked="checked">
          <label for="female">Female</label>
          <input type="radio" name="gender" id="female" value="female"><br>
          <label for="code">Code</label>
          <input type="text" name="code" id="code" value="A" required><br>
        </form>

        Devices: <br>

        <div id="devices" class="pre-scrollable" align="left" style="width: 70%"></div>
      </div>

      <div id="right" align="left" style="width: 80%; float:right">
        <div> <button id="pair" onclick="pair()"/> Pair </div>
        <div> <button id="start" onclick="start()"/> Start </div>
        <div> <button id="stop" onclick="stop()"/> Stop </div>
        <div id="calories" class="gauge"></div>
        <div id="time" class="gauge"></div>
      </div>
      <br style="clear:both;"/> 
    </div>

<script>
    var g1;
    var g2;

    var name = "firstsmartwatch"

    var server_url = "http://localhost:9023/api/smartwatch/"

    var selected = null

    var names = ["A", "B"]

    var devices = ""

    var age, gender, weight, code, exerciseDuration;

    var interval;

    names.forEach(function(entry) {
      devices += "<div id=" + entry + " onclick=\"clicked(" + entry + ")\"><pre><font color=black>" + entry + "</pre></font></div>"
    })

    $("#devices").html(devices)

    function changeColorToSelected(obj) {
      $("#pair").show()

      $.each( $('#devices'), function(i, left) {
         $('div', left).each(function() {
            html = $(this).html()
            $(this).html(html.replace("green", "black"))
         });
      })

      html = $(obj).html()
      $(obj).html(html.replace("black", "green"))
      selected = obj
    }

    function show_widgets() {
        calories = new JustGage({
            id: "calories",
            value: 0,
            min: 0,
            max: 2000,
            gaugeWidthScale: 0.2,
            counter: true,
            hideInnerShadow: true,
            title: "Calories"
        });

        time = new JustGage({
            id: "time",
            value: 0,
            min: 0,
            max: 100,
            symbol: '%',
            donut: true,
            gaugeWidthScale: 0.2,
            counter: true,
            hideInnerShadow: true,
            title: "Sport time"
        });

        interval = setInterval(update_widgets, 1000)
    }

    function update_widgets() {
      var url = server_url.concat("/calories?")
                .concat("name=").concat(selected.id);

      console.log(url)

      $.get(url, function(data, status, xhr) {
          console.log(data)
          console.log("cal:" + data["calories"])
          console.log("dur: " + data["exercisePercentage"])
          time.refresh(data["exercisePercentage"]);
          calories.refresh(data["calories"]);
      }, "json");
    }

    function pair() {
      if (selected) {
        console.log("Pairing " + selected.id)

        var url = server_url.concat("/pair?")
                  .concat("name=")
                  .concat(selected.id)
                  .concat("&")
                  .concat("code=")
                  .concat(document.forms["person"]["code"].value);

        console.log(url)

        $.get(url, function(data, status, xhr) {
            console.log(data)

            if (data.localeCompare("ok") == 0) {
                // warn
                console.log("Successful pairing")
                $("#pair").hide()
            } else {
                console.log(data)
            }
        }, "text");
      }
    }

    function start() {
      if (selected) {
        console.log("Starting " + selected.id)

        var url = server_url.concat("/start?")
                  .concat("name=").concat(selected.id)
                  .concat("&age=").concat(age)
                  .concat("&isMale=").concat($("#male").is(":checked"))
                  .concat("&weight=").concat(weight)
                  .concat("&exerciseDuration=").concat(exerciseDuration);

        console.log(url)

        $.get(url, function(data, status, xhr) {
            console.log(data)

            if (data.localeCompare("ok") == 0) {
                // warn
                console.log("Successful starting")
                $("#pair").hide()

                show_widgets()

            } else {
                console.log(data)
            }
        }, "text");
      }
    }

    function stop() {
      if (selected) {
        console.log("Stopping " + selected.id)

        var url = server_url.concat("/stop?")
                  .concat("name=")
                  .concat(selected.id);

        console.log(url)

        $.get(url, function(data, status, xhr) {
            console.log(data)

            if (data.localeCompare("ok") == 0) {
                // warn
                console.log("Successful stopping")
                clearInterval(interval)
            } else {
                console.log(data)
            }
        }, "text");
      }
    }

    function clicked(obj) {
      var isValid = validateForm()

      if (!isValid) {
        return;
      }

      age = document.forms["person"]["age"].value;
      gender = document.forms["person"]["gender"].value;
      weight = document.forms["person"]["weight"].value;
      code = document.forms["person"]["code"].value;
      exerciseDuration = document.forms["person"]["exerciseDuration"].value;

      changeColorToSelected(obj)
    }

    function validateForm() {
        var age = document.forms["person"]["age"].value;
        var gender = document.forms["person"]["gender"].value;
        var weight = document.forms["person"]["weight"].value;
        var code = document.forms["person"]["code"].value;
        var exerciseDuration = document.forms["person"]["exerciseDuration"].value;

        var valid = false;
        var checked = false;

        if (!isNaN(age) && age > 0 && !isNaN(weight) && weight > 0 && code != null && code.length > 0 && !isNaN(exerciseDuration) && exerciseDuration > 0) {
            valid = true;
        }

        var radios = document.getElementsByName('gender')

        for (var i = 0; i < radios.length; i++) {
            if (radios[i].checked) {
              checked = true;
            }
        };

        if (!valid || !checked) {
          if (isNaN(weight) || weight < 1) {
            alert("Weight not valid");
            return false;
          }

          if (isNaN(age) || age < 1) {
            alert("Age not valid");
            return false;
          }
          
          if (!checked) {
            alert("Gender not selected");
            return false;
          }

          if (code == null || (code != null && code.length == 0)) {
            alert("Code not valid");
            return false;
          }
        }

        return valid && checked;
    }
</script>

</body>

</html>